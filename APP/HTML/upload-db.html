<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Upload Student Data | Adelante Maps</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="{{ url_for('static', path='css/upload-db.css') }}">
</head>
<body>
  <div class="container">
    <a href="/manage-files" class="back-link">
      <i class="fas fa-arrow-left"></i>
      Back to Manage Files
    </a>

    <div class="page-header">
      <h1>Database Management</h1>
    </div>

    <!-- Upload Section -->
    <div class="section">
      <div class="section-header">
        <h3><i class="fas fa-cloud-upload-alt"></i> Upload Student Data</h3>
        <p>Add new student records to the database</p>
      </div>

      <!-- Senior High Upload -->
      <div class="upload-form">
        <h4>Senior High School Students</h4>
        <form id="seniorHighFileUploadForm">
          <div class="file-input-container">
            <label class="file-input-label">
              <i class="fas fa-file-upload"></i>
              <span id="seniorhigh-file-label">Choose processed SHS file</span>
              <input type="file" id="seniorHighFile" class="file-input" accept=".csv">
            </label>
            <button type="submit" class="button">
              <i class="fas fa-upload"></i>
              Upload
            </button>
          </div>
        </form>
      </div>

      <!-- College Upload -->
      <div class="upload-form">
        <h4>College Students</h4>
        <form id="collegeUploadForm">
          <div class="file-input-container">
            <label class="file-input-label">
              <i class="fas fa-file-upload"></i>
              <span id="college-file-label">Choose processed college file</span>
              <input type="file" id="collegeFile" class="file-input" accept=".csv">
            </label>
            <button type="submit" class="button">
              <i class="fas fa-upload"></i>
              Upload
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Remove Section -->
    <div class="section">
      <div class="section-header">
        <h3><i class="fas fa-trash-alt" style="color: #dc2626;"></i> Remove Student Data</h3>
        <p>Remove existing student records from the database</p>
      </div>

      <div class="grid">
        <!-- Student data remove -->
        <div class="grid-item">
          <h4>Student Data</h4>
          <p>Remove all student records</p>
          <button id="removeData" class="button button-red">
            <i class="fas fa-trash-alt"></i>
            Remove
          </button>
        </div>

    <!-- Student Data Confirmation Modal -->
    <div id="studentDataModal" class="modal">
      <div class="modal-content">
        <h2>Confirm Removal</h2>
        <p>Are you sure you want to remove all student records?</p>
        <div class="modal-buttons">
          <button id="cancelRemove" class="button" style="background-color: #9ca3af;">Cancel</button>
          <button id="confirmData" class="button button-red">Remove</button>
        </div>
      </div>
    </div>

  <script>
    // File input handling for Senior High
    const seniorHighFileInput = document.getElementById('seniorHighFile');
    const seniorHighFileLabel = document.getElementById('seniorhigh-file-label');

    seniorHighFileInput.addEventListener('change', function() {
      if (this.files.length > 0) {
        const file = this.files[0];
        if (file.type !== "text/csv") {
          alert("Please upload a valid CSV file.");
          this.value = ""; // reset file input
          seniorHighFileLabel.textContent = "Choose processed SHS file";
          seniorHighFileLabel.style.color = "";
          seniorHighFileLabel.style.fontWeight = "";
          return;
        }
        seniorHighFileLabel.textContent = file.name;
        seniorHighFileLabel.style.color = "#2563eb";
        seniorHighFileLabel.style.fontWeight = "bold";
      } else {
        seniorHighFileLabel.textContent = "Choose processed SHS file";
        seniorHighFileLabel.style.color = "";
        seniorHighFileLabel.style.fontWeight = "";
      }
    });

    // File input handling for College
    const collegeFileInput = document.getElementById('collegeFile');
    const collegeFileLabel = document.getElementById('college-file-label');

    collegeFileInput.addEventListener('change', function() {
      if (this.files.length > 0) {
        const file = this.files[0];
        if (file.type !== "text/csv") {
          alert("Please upload a valid CSV file.");
          this.value = ""; // reset file input
          collegeFileLabel.textContent = "Choose processed college file";
          collegeFileLabel.style.color = "";
          collegeFileLabel.style.fontWeight = "";
          return;
        }
        collegeFileLabel.textContent = file.name;
        collegeFileLabel.style.color = "#2563eb";
        collegeFileLabel.style.fontWeight = "bold";
      } else {
        collegeFileLabel.textContent = "Choose processed college file";
        collegeFileLabel.style.color = "";
        collegeFileLabel.style.fontWeight = "";
      }
    });

    // Form submission handlers
    const seniorHighUploadForm = document.getElementById('seniorHighFileUploadForm');
    const collegeUploadForm = document.getElementById('collegeUploadForm');

    seniorHighUploadForm.addEventListener('submit', async (event) => {
      event.preventDefault();
      const fileInput = document.getElementById('seniorHighFile');
      const file = fileInput.files[0];

      if (file) {
        const formData = new FormData();
        formData.append('file', file);

        try {
          const response = await fetch('/api/upload/senior-high-data', {
            method: 'POST',
            body: formData,
          });

          const result = await response.json();
          alert(result.message || 'Upload successful');
        } catch (error) {
          alert('Failed to upload senior high data');
        }
      }
    });

    collegeUploadForm.addEventListener('submit', async (event) => {
      event.preventDefault();
      const fileInput = document.getElementById('collegeFile');
      const file = fileInput.files[0];

      if (file) {
        const formData = new FormData();
        formData.append('file', file);

        try {
          const response = await fetch('/api/upload/college-data', {
            method: 'POST',
            body: formData,
          });

          const result = await response.json();
          alert(result.message || 'Upload successful');
        } catch (error) {
          alert('Failed to upload college data');
        }
      }
    });

    // Modal handling
    const removeData = document.getElementById('removeData');
    const studentDataModal = document.getElementById('studentDataModal');

    removeData.addEventListener('click', () => {
      studentDataModal.style.display = 'flex';
    });

    document.getElementById('cancelRemove').addEventListener('click', () => {
      studentDataModal.style.display = 'none';
    });

    // Confirm removal handlers
    document.getElementById('confirmData').addEventListener('click', async () => {
      try {
        const response = await fetch('/api/remove-all-student-data', {
          method: 'POST',
        });
        const result = await response.json();
        alert(result.message || 'Student data removed');
      } catch (error) {
        alert('Failed to remove Student data');
      } finally {
        studentDataModal.style.display = 'none';
      }
    });

    // Close modals when clicking outside
    window.addEventListener('click', (e) => {
      if (e.target === studentDataModal) {
        studentDataModal.style.display = 'none';
      }
    });
  </script>
</body>
</html>